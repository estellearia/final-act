<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Always Choose Her</title>
  <!-- Google Fonts: Pixel and Script -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Pacifico&display=swap" rel="stylesheet">
  <style>
    html, body {
      min-height: 100vh;
      min-width: 100vw;
      margin: 0; padding: 0; overflow-x: hidden;
      font-family: 'Press Start 2P', monospace;
      font-size: 13px;
      text-align: center;
      background:
        radial-gradient(ellipse at 60% 80%, #d6f3ff 0%, #a3d8ff 16%, #353a5c 55%, #141332 80%, #06061a 100%),
        linear-gradient(180deg, #23204488 0%, #292a5a40 100%);
      color: #fff8e7;
    }
    body {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      min-height: 100vh; min-width: 100vw; text-align: center;
    }
    .star-bg, .star-bg-glow, .twinkle-bg {
      pointer-events: none;
      position: fixed;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      z-index: 0;
      opacity: 1;
      overflow: hidden;
    }
    .star-bg-glow {
      filter: blur(2px) brightness(1.3);
      opacity: 0.5;
      z-index: 1;
    }
    .twinkle-bg {
      z-index: 2;
      pointer-events: none;
    }
    .shooting-star {
      position: absolute;
      width: 2px; height: 68px;
      background: linear-gradient(180deg, #fff7cb 15%, #aeeaff 60%, transparent 100%);
      opacity: 0.58;
      border-radius: 100px;
      pointer-events: none;
      animation: shooting-star 1.1s cubic-bezier(.8,.2,.2,1) forwards;
      box-shadow: 0 0 8px 2px #fffbe3cc, 0 0 15px #aeeaff77;
      image-rendering: auto;
    }
    @keyframes shooting-star {
      0%   { transform: translateY(-68px) scaleY(0.95) scaleX(0.8); opacity: 0; }
      8%  { opacity: 1; }
      85%  { opacity: 1; }
      100% { transform: translateY(110vh) scaleY(1.07) scaleX(0.92); opacity: 0; }
    }
    .twinkle-star {
      position: absolute;
      border-radius: 50%;
      background: #fffbe3;
      width: 2px; height: 2px;
      pointer-events: none;
      animation: twinkle 2.1s infinite alternate;
      image-rendering: auto;
    }
    @keyframes twinkle {
      0% { opacity: 0.42; box-shadow: 0 0 2px 1px #ffd; }
      50% { opacity: 1; box-shadow: 0 0 5px 1.5px #fffbe3, 0 0 10px #a3e9ff55; }
      100% { opacity: 0.23; box-shadow: 0 0 2px 1px #ffd; }
    }
    .nebula {
      position: fixed;
      pointer-events: none;
      z-index: 0;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: radial-gradient(ellipse at 35% 70%, #b5d3fb22 0%, #7fa8d144 33%, transparent 67%),
                  radial-gradient(ellipse at 75% 30%, #c9b3ff14 0%, #a3e9ff13 35%, transparent 80%);
      opacity: 0.38;
      mix-blend-mode: lighten;
      animation: nebula-float 14s linear infinite alternate;
      image-rendering: auto;
    }
    @keyframes nebula-float {
      0% { background-position: 0% 0%, 100% 100%; }
      100% { background-position: 10% 8%, 90% 92%; }
    }
    .aurora {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 3;
      background: radial-gradient(ellipse at 60% 0%, #8ef9ff15 0%, transparent 60%),
                  radial-gradient(ellipse at 15% 5%, #e5d3ff11 0%, transparent 55%),
                  radial-gradient(ellipse at 82% 20%, #ffeaff0b 0%, transparent 65%);
      opacity: 0.13;
      mix-blend-mode: lighten;
      animation: aurora-move 12s linear infinite alternate;
      image-rendering: auto;
    }
    @keyframes aurora-move {
      0% { background-position: 0% 0%, 100% 100%, 50% 0%; }
      100% { background-position: 10% 8%, 90% 92%, 60% 10%; }
    }
    .lens-flare {
      position: fixed;
      pointer-events: none;
      left: 50%; top: 30%;
      width: 90px; height: 22px;
      z-index: 50;
      transform: translate(-50%, -50%) rotate(-12deg) scale(1);
      opacity: 0.10;
      background: radial-gradient(ellipse at 60% 50%, #fff5d9aa 0%, #fffbe388 40%, transparent 70%);
      filter: blur(3px);
      animation: flare-blink 8.6s infinite linear;
      image-rendering: auto;
    }
    @keyframes flare-blink {
      0% { opacity: 0.09; }
      18% { opacity: 0.18; }
      32% { opacity: 0.06; }
      35% { opacity: 0.14; }
      50% { opacity: 0.07; }
      100% { opacity: 0.10; }
    }
    .hidden { display: none !important; }
    .memory-title {
      font-size: 16px;
      color: #ffe764;
      text-shadow: 0 0 11px #fffbe3, 0 0 17px #ffe764b5, 0 0 32px #7eeaff50;
      letter-spacing: 0.5px;
      margin-bottom: 7px;
      margin-top: 26px;
      text-align: center;
      user-select: none;
      line-height: 1.25;
      font-family: 'Press Start 2P', monospace;
    }
    #memoryInstructionLines {
      width: 100%;
      max-width: 340px;
      margin: 0 auto 11px auto;
      display: block;
      text-align: center;
    }
    .memory-instruction-quote {
      color: #ffe764;
      font-size: 0.8em;
      background: rgba(38, 39, 80, 0.32);
      border-radius: 6px;
      padding: 8px 13px 8px 13px;
      border: 1.5px solid #ffe76433;
      display: inline-block;
      font-style: italic;
      letter-spacing: 0.5px;
      line-height: 1.8;
      white-space: pre-line;
      margin: 0 auto 0 auto;
      user-select: none;
      box-shadow: 0 0 8px #ffe76414;
    }
    .pixel-frame {
      background: rgba(24,16,40,0.95);
      border-radius: 13px;
      box-shadow: 0 0 0 2px #ffe76455, 0 0 0 6px #353a5c, 0 0 35px 8px #aeeaff11, 0 0 0 1.5px #ffe764;
      max-width: 350px;
      width: 98vw;
      margin: 0 auto;
      margin-bottom: 21px;
      padding: 18px 11px 18px 11px;
      box-sizing: border-box;
      position: relative;
      display: block;
      text-align: center;
      z-index: 2;
      backdrop-filter: blur(0.7px);
      animation: float-in 1.2s cubic-bezier(.5,0,.2,1);
      transition: box-shadow 0.12s;
      image-rendering: auto;
    }
    /* WIDE PIXEL-FRAME FOR ARIA SCENE */
    #ariaFrame.pixel-frame {
      background: none;
      box-shadow: none;
      border: none;
      max-width: unset;
      padding: 0;
    }
    @keyframes float-in {
      0% { opacity: 0; transform: translateY(23px) scale(0.96);}
      100% { opacity: 1; transform: translateY(0) scale(1);}
    }
    @media (max-width: 500px) {
      .pixel-frame { max-width: 99vw; padding: 5vw 1vw 4vw 1vw; }
      .memory-title { font-size: 13px; }
      #memoryInstructionLines { max-width: 98vw; }
    }
    .avatar {
      width: 64px;
      height: 64px;
      margin: 0 auto 16px auto;
      border-radius: 8px;
      box-shadow: 0 0 10px #ffe76424, 0 0 0 1.5px #ffe764, 0 0 10px #7eeaff12;
      border: 1px solid #ffe764;
      background: #191830;
      image-rendering: pixelated;
      transition: box-shadow 0.2s;
      animation: avatar-float 3.2s infinite cubic-bezier(.59,.03,.4,1.01) alternate;
    }
    @keyframes avatar-float {
      from { transform: translateY(0);}
      to   { transform: translateY(-8px);}
    }
    .pixel-text {
      color: #fffbe3;
      text-shadow: 1px 1px 0 #353a5c, 0 0 5px #ffe7646b;
      font-size: 12px;
      margin: 0.7em 0 0.4em 0;
      line-height: 1.8;
      letter-spacing: 0.7px;
      font-family: 'Press Start 2P', monospace;
      word-break: break-word;
      font-weight: normal;
      text-align: center;
    }
    .pixel-quote {
      color: #ffe764;
      font-size: 11px;
      margin-top: 1em;
      margin-bottom: 0.4em;
      text-shadow: 1px 1px 0 #353a5c, 0 0 7px #fffbe3b5;
      background: rgba(38, 39, 80, 0.23);
      border-radius: 4px;
      padding: 6px 8px;
      border: 1px solid #ffe76433;
      display: inline-block;
      font-style: italic;
      letter-spacing: 0.5px;
      line-height: 1.8;
      white-space: pre-line;
      text-align: center;
      box-shadow: 0 0 8px #ffe76410;
    }
    .button, .pixel-button {
      font-family: 'Press Start 2P', monospace;
      background: #191830;
      color: #ffe764;
      border: 2px solid #ffe764;
      border-radius: 6px;
      box-shadow: 0 2px 0 0 #353a5c, 0 0 8px #ffe76440 inset;
      padding: 4px 10px 4px 10px;
      cursor: pointer;
      margin: 13px 0 0 0;
      font-size: 10px;
      font-weight: normal;
      letter-spacing: 0.7px;
      text-shadow: 1px 1px 0 #353a5c, 0 0 4px #fffbe3b5;
      transition: background 0.16s, color 0.13s, border-color 0.13s, transform 0.07s;
      image-rendering: auto;
      position: relative;
      z-index: 1;
      outline: 0;
      min-width: 70px;
      min-height: 26px;;
      text-align: center;
      display: inline-block;
    }
    .button:hover, .pixel-button:hover {
      background: #ffe764;
      color: #191830;
      border-color: #fffbe3;
      transform: scale(1.07) translateY(-1px);
      box-shadow: 0 0 14px #ffe7648a, 0 3px 0 0 #353a5c;
    }
    .center-btn, .mewby-center-btn, .aria-btn-center {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      text-align: center;
    }
    .center-btn > *, .mewby-center-btn > *, .aria-btn-center > * {
      margin-left: 0 !important;
      margin-right: 0 !important;
      display: block;
      text-align: center;
    }
    .star-canvas {
      position: absolute;
      left: 0; top: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      image-rendering: auto;
    }
    .memory-fragment {
      width: 20px;
      height: 20px;
      margin: 5px;
      display: block;
      background: linear-gradient(145deg, #fffbe3 30%, #fcd34d 80%);
      border-radius: 50%;
      animation: glow 1.9s infinite alternate;
      cursor: pointer;
      box-shadow: 0 0 6px #fffbe3, 0 0 12px #ffe764;
      transition: box-shadow 0.15s, background 0.15s, border-color 0.15s, filter 0.12s;
      outline: 1px solid #fffbe3;
      outline-offset: 2px;
      border: 1px solid #ffe764;
      background-clip: padding-box;
      filter: drop-shadow(0 0 3px #ffe76418);
      image-rendering: auto;
    }
    .memory-fragment.visited {
      opacity: 0.18;
      pointer-events: none;
      background: #282840;
      border: 1px solid #ffe764;
      filter: none;
      box-shadow: 0 0 4px #ffe76410;
    }
    #memoryFragments {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      max-width: 110px;
      margin: 0 auto 4px auto;
      text-align: center;
      justify-content: center;
      z-index: 1;
      position: relative;
      image-rendering: auto;
    }
    #memoryMessageBox {
      display: none;
      font-size: 10px;
      color: #ffe764;
      background: rgba(38,39,80,0.14);
      border-radius: 7px;
      border: 1px solid #ffe76420;
      box-shadow: 0 0 8px #ffe76412;
      margin: 15px auto 0 auto;
      padding: 10px 10px 8px 10px;
      max-width: 190px;
      text-align: center;
      line-height: 1.8;
      font-weight: normal;
      letter-spacing: 0.13px;
      opacity: 1;
      transition: opacity 0.3s;
      position: relative;
      z-index: 2;
    }
    /* ARIA LETTER */
    .aria-letter-bg {
      background: linear-gradient(135deg, #fbf6e9 90%, #ffe0f2 100%);
      border-radius: 18px;
      box-shadow: 0 8px 40px 0 #ffe3f7cc, 0 0 0 2px #ffeecb99, 0 0 0 7px #ffe0f233, 0 0 60px 15px #aeeaff18;
      padding: 44px 40px 36px 40px;
      margin: 0 auto;
      position: relative;
      max-width: 700px;
      width: 98vw;
      min-height: 360px;
      text-align: left;
      animation: aria-letter-fadein 1.7s cubic-bezier(.4,0,.2,1);
      color: #473a24;
      font-family: 'Press Start 2P', monospace;
      line-height: 2.1;
      letter-spacing: 0.06em;
      border: 1.5px solid #ffeecb;
      z-index: 4;
    }
    @media (max-width: 700px) {
      .aria-letter-bg { padding: 9vw 3vw 7vw 3vw; max-width: 97vw; }
    }
    @keyframes aria-letter-fadein {
      0% { opacity: 0; transform: translateY(34px) scale(0.98);}
      100% { opacity: 1; transform: translateY(0) scale(1);}
    }
    .aria-letter-header {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin-bottom: 6px;
      gap: 11px;
    }
    .aria-letter-name {
      font-family: 'Pacifico', cursive;
      font-size: 2.13em;
      color: #e07ebf;
      letter-spacing: 0.028em;
      text-shadow: 0 2px 10px #ffe8f6cc, 0 0 1px #d863a7;
      line-height: 1.1;
    }
    .aria-letter-heart {
      font-size: 1.1em;
      color: #e07ebf;
      filter: drop-shadow(0 1px 3px #fcc8eb88);
    }
    .aria-letter-subtitle {
      font-size: 0.98em;
      font-style: italic;
      color: #e07ebf;
      opacity: 0.68;
      margin-bottom: 22px;
      margin-left: 2px;
      font-family: 'Press Start 2P';
      letter-spacing: 0.07em;
    }
     .aria-letter-content {
      margin-top: 8px;
      font-size: 0.95em;
      color: #473a24;
      font-family: 'Press Start 2P', monospace;
      background: none;
      line-height: 1.9;
      border: none;
      padding: 0;
      white-space: pre-line;
    }
    .aria-letter-signoff {
      margin-top: 36px;
      font-family: 'Pacifico', cursive;
      font-size: 1.5em;
      color: #e07ebf;
      text-align: right;
      text-shadow: 0 1px 7px #ffe0f288, 0 0 1px #d863a7;
    }
    .aria-letter-stars {
      position: absolute;
      top: 18px; right: 24px;
      pointer-events: none;
      font-size: 1.35em;
      color: #ffe764;
      opacity: 0.7;
      text-shadow: 0 0 9px #ffe764bb, 0 0 14px #fcd34d99;
    }
    .aria-letter-stars.left {
      left: 24px; right: unset; top: 18px; transform: scaleX(-1) rotate(-6deg);
    }
    .aria-letter-tape {
      position: absolute;
      left: 19px; top: -19px;
      width: 58px; height: 29px;
      background: linear-gradient(96deg, #ffe2e7 70%, #fffbe3 100%);
      border-radius: 7px 15px 9px 13px;
      box-shadow: 0 2px 8px #fdd3d822, 0 0 2px #ffe0f2;
      z-index: 5;
      transform: rotate(-7deg);
      opacity: 0.94;
      border: 1px solid #ffb9d7;
    }
    @media (max-width: 600px) {
      .aria-letter-bg { padding: 7vw 2vw 7vw 2vw; }
      .aria-letter-header { flex-direction: column; align-items: flex-start; }
      .aria-letter-name { font-size: 1.3em; }
      .aria-letter-signoff { font-size: 1.1em; }
    }
    #ariaSprite {
      width: 64px;
      height: 64px;
      margin: 0 auto 10px auto;
      border-radius: 7px;
      background: #191830;
      border: 1px solid #ffe764;
      box-shadow: 0 0 11px #ffe76433, 0 0 0 1px #ffe764;
      image-rendering: pixelated;
      text-align: center;
      animation: avatar-float 4.3s infinite alternate;
      display: block;
    }
    .final-choice-btns {
      gap: 14px;
      margin-top: 10px;
    }
    @keyframes glow {
      from { box-shadow: 0 0 8px #ffe764, 0 0 17px #fffbe3; }
      to { box-shadow: 0 0 11px #ffe764, 0 0 18px #fcd34d; }
    }
  </style>
</head>
<body>
  <!-- Dreamy cosmic background layers and all your UI -->
<audio id="dreamyBgAudio" loop preload="auto">
  <source src="https://github.com/estellearia/type-sound/raw/refs/heads/main/That%20Feeling.mp3" type="audio/mp3">
</audio>
  <button id="muteBtn" style="position:fixed;top:14px;right:14px;z-index:1000;
    background:rgba(38,39,80,0.6);border-radius:50%;border:2px solid #ffe764;
    width:26px;height:26px;display:flex;align-items:center;justify-content:center;
    color:#ffe764;font-size:13px;cursor:pointer;box-shadow:0 0 8px #ffe76450;">
    &#128266;
  </button>
  <div class="nebula"></div>
  <div class="star-bg" id="starBg"></div>
  <div class="star-bg-glow" id="starBgGlow"></div>
  <div class="twinkle-bg" id="twinkleBg"></div>
  <div class="aurora"></div>
  <div class="lens-flare"></div>

  <div class="memory-title" id="memoryTitle">Your memories with Aria</div>
  <div id="memoryInstructionLines">
    <span class="memory-instruction-quote" id="memoryInstructionQuote"></span>
  </div>

  <!-- MEWBIE INTRO SCENE -->
  <div class="pixel-frame" id="mainFrame">
    <img src="https://64.media.tumblr.com/647ca06c5a608d1ea1c416b21b839ea3/9a98a57c72a06121-2a/s250x400/7f925df3ce70975efc97a7f0ffac27ea3838ae3e.gif"
      alt="Mewby" class="avatar" loading="lazy" />
    <p id="mewbyGreeting" class="pixel-text" style="min-height: 1.5em"></p>
    <div id="mewbyQuoteContainer" style="width:100%;">
      <p id="mewbyQuote" class="pixel-quote"></p>
    </div>
    <div class="center-btn mewby-center-btn">
      <button class="button" id="mewbyContinue" style="display:none;">Continue</button>
    </div>
  </div>

  <!-- MEMORIES SCENE -->
  <div class="pixel-frame hidden" id="memoriesFrame" style="position:relative;">
    <canvas id="starCanvas" class="star-canvas"></canvas>
    <div id="memoryFragments"></div>
    <div id="memoryMessageBox"></div>
    <div class="center-btn" id="memoriesNextBtnContainer" style="display:none;">
      <button class="button" id="memoriesNext" aria-label="Next to final scene">Next</button>
    </div>
  </div>

  <!-- FINAL CHOICE SCENE -->
  <div class="pixel-frame hidden" id="finalFrame">
    <p class="pixel-text" style="font-size:13px; margin-bottom:9px; color:#ffe764; text-shadow:0 0 9px #fffbe3;">
      You've remembered enough. What will you do?</p>
    <div class="final-choice-btns">
      <button class="button" id="chooseEasyBtn" onclick="chooseEasy()">Choose Easy</button>
      <button class="button" id="chooseHerBtn" onclick="chooseHer()">Choose Her</button>
    </div>
  </div>

  <!-- ARIA MESSAGE SCENE -->
  <div class="pixel-frame centered hidden" id="ariaFrame">
    <img src="https://i.imgur.com/9OC7GRw.gif" alt="Aria" id="ariaSprite" loading="lazy" style="margin-bottom:14px;" />
    <div class="aria-letter-bg">
      <div class="aria-letter-tape"></div>
      <div class="aria-letter-stars">&#10024;&#11088;&#10024;</div>
      <div class="aria-letter-stars left">&#10024;&#11088;&#10024;</div>
      <div class="aria-letter-header">
        <span class="aria-letter-name">Aria</span>
        <span class="aria-letter-heart">&#10084;&#65039;</span>
      </div>
      <div class="aria-letter-subtitle">A letter for you</div>
      <div class="aria-letter-content" id="ariaMsg"></div>
      <div class="aria-letter-signoff" id="ariaSignoff" style="display:none;">With all my love,<br>Aria</div>
    </div>
    <div class="aria-btn-center">
      <button class="pixel-button" id="ariaHomeBtn" onclick="window.location.href='https://estellearia.github.io/aria-messages/prolouge.html';" style="display:none;">
        return home
      </button>
    </div>
  </div>


  <script>
    // Dreamy audio logic
    const dreamyAudio = document.getElementById('dreamyBgAudio');
    const muteBtn = document.getElementById('muteBtn');
    let isMuted = false;
    let dreamyStarted = false;
function startDreamyAudio() {
  if (!dreamyStarted) {
    dreamyAudio.volume = 0.22;
    dreamyAudio.currentTime = 13; // Start playing at 13 seconds
    dreamyAudio.play();
    dreamyStarted = true;
  }
}
    window.addEventListener('pointerdown', startDreamyAudio, {once:true});
    muteBtn.onclick = () => {
      isMuted = !isMuted;
      dreamyAudio.muted = isMuted;
      muteBtn.innerHTML = isMuted ? "&#128263;" : "&#128266;";
    };

    // --- COSMIC STAR BACKGROUND ---
    function makeStars(container, count, colors, blur = false) {
      container.innerHTML = '';
      for(let i=0;i<count;i++){
        const s = document.createElement('div');
        let size = Math.random() < 0.8 ? 2 : 3;
        s.style.position = "absolute";
        s.style.left = `${Math.random()*100}%`;
        s.style.top = `${Math.random()*100}%`;
        s.style.width = s.style.height = `${size}px`;
        s.style.background = colors[Math.floor(Math.random()*colors.length)];
        s.style.opacity = (Math.random()*0.6+0.24).toFixed(2);
        s.style.borderRadius = "50%";
        s.style.boxShadow = blur
          ? `0 0 8px #a3e9fff7, 0 0 16px #fffbe3a8`
          : "0 0 4px #fff8ef, 0 0 8px #ffe764";
        s.style.filter = blur ? "blur(0.7px)" : "";
        s.style.pointerEvents = "none";
        s.style.imageRendering = "auto";
        container.appendChild(s);
      }
    }
    function spawnShootingStar() {
      const sky = document.getElementById('starBg');
      const star = document.createElement('div');
      star.className = 'shooting-star';
      star.style.left = `${Math.random()*96+2}vw`;
      star.style.top = `-${Math.random()*30+2}px`;
      sky.appendChild(star);
      setTimeout(() => star.remove(), 1200);
    }
    function makeTwinkles(container, count) {
      container.innerHTML = '';
      for(let i=0;i<count;i++) {
        const t = document.createElement('div');
        t.className = 'twinkle-star';
        t.style.left = `${Math.random()*100}%`;
        t.style.top = `${Math.random()*100}%`;
        let size = Math.random() < 0.8 ? 2 : 3;
        t.style.width = t.style.height = `${size}px`;
        t.style.animationDelay = `${Math.random()*2.1}s`;
        t.style.imageRendering = "auto";
        container.appendChild(t);
      }
    }
    function flareLoop() {
      const flare = document.querySelector('.lens-flare');
      flare.style.opacity = Math.random()*0.09 + 0.09;
      setTimeout(flareLoop, 6000+Math.random()*4000);
    }
    function refreshStars() {
      makeStars(document.getElementById('starBg'), 18, ["#fffbe3", "#ffe764", "#a3e9ff"], false);
      makeStars(document.getElementById('starBgGlow'), 7, ["#fffbe3", "#a3e9ff"], true);
      makeTwinkles(document.getElementById('twinkleBg'), 8);
    }
    window.addEventListener("DOMContentLoaded", () => {
      refreshStars();
      flareLoop();
    });
    window.addEventListener("resize", refreshStars);
    setInterval(() => { if(Math.random()<0.12) spawnShootingStar(); }, 1400);

    // --- INSTRUCTIONS TYPING ---
    const memoryInstructionLines = [
      "Click each memory fragment one at a time."
    ];
    let memoryInstructionLine = 0, memoryInstructionChar = 0;
    function typeMemoryInstructionLine() {
      const el = document.getElementById('memoryInstructionQuote');
      if (memoryInstructionLine < memoryInstructionLines.length) {
        if (memoryInstructionChar < memoryInstructionLines[memoryInstructionLine].length) {
          el.innerHTML += memoryInstructionLines[memoryInstructionLine][memoryInstructionChar++];
          setTimeout(typeMemoryInstructionLine, 60);
        } else {
          if (memoryInstructionLine < memoryInstructionLines.length - 1) {
            el.innerHTML += '<br>';
          }
          memoryInstructionLine++;
          memoryInstructionChar = 0;
          setTimeout(typeMemoryInstructionLine, 250);
        }
      }
    }

    // --- MEWBIE INTRO TYPING ---
    const mewbyGreetingText = "Hey! Mewby is here!";
    const mewbyQuoteLines = [
      "We’re about to take a little walk through memories and moments between you and Aria.",
      "Ready to start your journey?"
    ];
    let mewbyGreetingIndex = 0, mewbyQuoteLine = 0, mewbyQuoteChar = 0;
    function typeMewbyGreeting() {
      const el = document.getElementById('mewbyGreeting');
      if (mewbyGreetingIndex < mewbyGreetingText.length) {
        el.textContent += mewbyGreetingText[mewbyGreetingIndex++];
        setTimeout(typeMewbyGreeting, 60);
      } else {
        setTimeout(() => {
          document.getElementById('mewbyQuote').innerHTML = "";
          document.getElementById('mewbyQuoteContainer').style.display = 'block';
          typeMewbyQuoteLine();
        }, 440);
      }
    }
    function typeMewbyQuoteLine() {
      const quoteContainer = document.getElementById('mewbyQuoteContainer');
      quoteContainer.style.display = "block";
      const el = document.getElementById('mewbyQuote');
      if (mewbyQuoteLine < mewbyQuoteLines.length) {
        if (mewbyQuoteChar < mewbyQuoteLines[mewbyQuoteLine].length) {
          el.innerHTML += mewbyQuoteLines[mewbyQuoteLine][mewbyQuoteChar++];
          setTimeout(typeMewbyQuoteLine, 60);
        } else {
          if (mewbyQuoteLine < mewbyQuoteLines.length - 1) {
            el.innerHTML += '<br><br>';
          }
          mewbyQuoteLine++;
          mewbyQuoteChar = 0;
          setTimeout(typeMewbyQuoteLine, 400);
        }
      } else {
        setTimeout(() => {
          document.getElementById('mewbyContinue').style.display = 'inline-block';
        }, 400);
      }
    }
    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById('mewbyQuoteContainer').style.display = "block";
      typeMewbyGreeting();
      document.getElementById('memoryTitle').style.display = "none";
      document.getElementById('memoryInstructionLines').style.display = "none";
    });

    // --- SCENE MANAGEMENT ---
    function showOnly(id) {
      ['mainFrame','memoriesFrame','finalFrame','ariaFrame','meetingScene'].forEach(x => {
        const el = document.getElementById(x);
        if (el) el.classList.add('hidden');
      });
      document.getElementById(id).classList.remove('hidden');
      // Hide the memory lane title/instructions unless we're in memoriesFrame
      const showMemoryStuff = (id === 'memoriesFrame');
      document.getElementById('memoryTitle').style.display = showMemoryStuff ? 'block' : 'none';
      document.getElementById('memoryInstructionLines').style.display = showMemoryStuff ? 'block' : 'none';
      // Make sure to call drawStars only after the scene is shown and DOM is ready
      if (showMemoryStuff) setTimeout(drawStars, 0);
      window.scrollTo(0,0);
    }

    document.getElementById('mewbyContinue').onclick = () => {
      document.getElementById('memoryInstructionQuote').innerHTML = '';
      memoryInstructionLine = 0; memoryInstructionChar = 0;
      showOnly('memoriesFrame');
      setTimeout(() => {
        typeMemoryInstructionLine();
        initMemories();
      }, 420);
    };

    // --- STAR CANVAS FOR MEMORY LANE ---
    function drawStars() {
      const canvas = document.getElementById('starCanvas');
      if (!canvas) return;
      const parent = document.getElementById('memoriesFrame');
      canvas.width = parent.offsetWidth;
      canvas.height = 110;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);

      for (let i = 0; i < 12; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height * 0.9 + 5;
        const size = Math.random() < 0.8 ? 2 : 3;
        ctx.save();
        ctx.globalAlpha = Math.random() * 0.3 + 0.5;
        ctx.fillStyle = Math.random() > 0.5 ? "#ffe764" : "#fffbe3";
        ctx.beginPath();
        ctx.arc(Math.floor(x), Math.floor(y), size, 0, 2 * Math.PI);
        ctx.fill();
        ctx.restore();
      }
    }
    window.addEventListener('resize', drawStars);

    // --- MEMORY LANE LOGIC ---
    const memoriesData = [
      { title: "First commitment", desc: "The first irrational decision, an awkward vid call playing fall guys together.", visited: false },
      { title: "Our favorite emoji", desc: " '><' and 'TT' represents US.", visited: false },
      { title: "First physical interaction", desc: "That karaoke room really had an effect on us, huh?.", visited: false },
      { title: "Marathon nights", desc: "We just binged, sleep, eat and feel together.", visited: false },
      { title: "Our first video game night", desc: "Laughing and playing like no distance existed.", visited: false },
      { title: "The first 'I love you'", desc: "That shy, unforgettable moment and our first day being official", visited: false }
    ];
    let memoryMessageTimeout = null;
    function initMemories() {
      drawStars();
      const memoryFragmentsEl = document.getElementById('memoryFragments');
      const messageBox = document.getElementById('memoryMessageBox');
      const memoriesNextBtn = document.getElementById('memoriesNext');
      const memoriesNextBtnContainer = document.getElementById('memoriesNextBtnContainer');
      memoryFragmentsEl.innerHTML = '';
      messageBox.style.display = "none";
      messageBox.textContent = "";
      memoriesNextBtnContainer.style.display = "none";
      memoriesNextBtn.disabled = true;
      memoriesNextBtn.style.opacity = 0.3;
      memoriesNextBtn.setAttribute('aria-disabled', 'true');
      if (memoryMessageTimeout) clearTimeout(memoryMessageTimeout);

      memoriesData.forEach((memory, i) => memory.visited = false);

      memoriesData.forEach((memory, i) => {
        const circle = document.createElement('div');
        circle.className = 'memory-fragment';
        circle.tabIndex = 0;
        circle.setAttribute('role', 'button');
        circle.setAttribute('aria-label', `${memory.title} memory`);
        circle.dataset.index = i;

        circle.addEventListener('click', () => {
          if (memory.visited) return;
          memory.visited = true;
          circle.classList.add('visited');
          // Show message
          messageBox.innerHTML =
            `<span style="font-size:11px;font-weight:bold;color:#ffe764;display:block;margin-bottom:6px;">${memory.title}</span>
            <span style="font-size:11px;color:#fffbe3;font-weight:normal;display:block;">${memory.desc}</span>`;
          messageBox.style.display = "block";
          messageBox.style.opacity = "1";
          if (memoryMessageTimeout) clearTimeout(memoryMessageTimeout);
          memoryMessageTimeout = setTimeout(() => {
            messageBox.style.opacity = "0";
            setTimeout(() => {
              messageBox.style.display = "none";
              messageBox.innerHTML = "";
            }, 400);
          }, 2100);

          // If all visited, enable Next button and show last desc
          if (memoriesData.every(m => m.visited)) {
            memoriesNextBtn.disabled = false;
            memoriesNextBtn.style.opacity = 1;
            memoriesNextBtn.setAttribute('aria-disabled', 'false');
            messageBox.innerHTML = `<span style="font-size:11px;font-weight:bold;color:#ffe764;display:block;margin-bottom:7px;">All memories revisited.</span>`;
            messageBox.style.display = "block";
            messageBox.style.opacity = "1";
            memoriesNextBtnContainer.style.display = "flex";
            if (memoryMessageTimeout) clearTimeout(memoryMessageTimeout);
          }
        });

        // Keyboard accessibility: Enter or Space triggers click
        circle.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            circle.click();
          }
        });

        memoryFragmentsEl.appendChild(circle);
      });

      memoriesNextBtn.onclick = () => {
        showOnly('finalFrame');
      };
    }

    // --- FINAL CHOICE LOGIC ---
    function chooseHer() {
      document.getElementById("chooseHerBtn").style.display = "none";
      document.getElementById("chooseEasyBtn").style.display = "none";
      // Directly fade to letter, SKIP meetingScene
      const finalFrame = document.getElementById('finalFrame');
      finalFrame.style.transition = "opacity 0.8s cubic-bezier(.4,0,.2,1)";
      finalFrame.style.opacity = "1";
      setTimeout(() => {
        finalFrame.style.opacity = "0";
        setTimeout(() => {
          finalFrame.style.opacity = "";
          showAriaMessage();
        }, 820);
      }, 200);
    }
    function chooseEasy() {
      alert("You chose the easy way out... But this story is about choosing love.");
    }

    // --- ARIA MESSAGE SCENE ---
    const ariaMessage = `How was your journey, baby?
Did you have fun? I really hope so, TT.
This is the only way I could think of to make your day extra special—just me, my code, and, of course, you.
Since we both love games, I figured, why not design a world just for you? That’s how much you mean to me.

Our story started with a friendship that was tested by others, but somehow… you found your way back into my life.
When you did, I saw you in a new light, and everything changed.
That’s when we really began.
Honestly, even if I had to go through all the tough times again, I would, because I’d always choose you.

Being with you, even on the hardest days, means more to me than an easy life without you.
You’re my home now, loove. My forever.
Our road might be bumpy, but I’m grateful that, no matter what, every journey’s finish line is with you.

Just like this game, I want you to always remember that even when our journey isn’t perfect, when it feels like we’ve lost each other, or when we doubt ourselves if we're ever the right person for each other— Baby, I’m always at the other end.
As long as we’re willing to keep trying, nothing is impossible for us.

I hope this little adventure reminded you of our story, there were sad times, but so many fun ones too.
It’s not perfect, but it’s everything to me, as long as you’re there.

Happy, happy birthday, my love. I’m so grateful I met you.
Thank you for coming back to me and choosing me.
I’ll always be thankful you were born, because you bring so much color to my life.

I can’t wait for us to meet again in person, imagine hugging and kissing you? that's the dream my looove!!
So you better get your ass here soon! Char!
I'm really proud that i get to call you MIIIINE!
I love you more than most, baby.
You really are the best-EST thing that ever happened to me.
Happy Happiest Birthdaaaay, my love!`;

    function showAriaMessage() {
      showOnly('ariaFrame');
      const box = document.getElementById('ariaMsg');
      const homeBtn = document.getElementById('ariaHomeBtn');
      const signoff = document.getElementById('ariaSignoff');
      box.textContent = "";
      homeBtn.style.display = "none";
      signoff.style.display = "none";
      let idx = 0;
      function typeAria() {
        if(idx <= ariaMessage.length){
          box.textContent = ariaMessage.substring(0, idx);
          idx++;
          setTimeout(typeAria, 60);
        } else {
          signoff.style.display = "block";
          homeBtn.style.display = "inline-block";
        }
      }
      typeAria();
    }
  </script>
</body>
</html>
