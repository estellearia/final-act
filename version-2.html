<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Always Choose Her</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    html, body {
      min-height: 100vh;
      min-width: 100vw;
      margin: 0; padding: 0; overflow-x: hidden;
      font-family: 'Press Start 2P', monospace;
      font-size: 13px;
      text-align: center;
      background:
        radial-gradient(ellipse at 60% 80%, #d6f3ff 0%, #a3d8ff 16%, #353a5c 55%, #141332 80%, #06061a 100%),
        linear-gradient(180deg, #23204488 0%, #292a5a40 100%);
      color: #fff8e7;
    }
    body {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      min-height: 100vh; min-width: 100vw; text-align: center;
    }
    .star-bg, .star-bg-glow, .twinkle-bg {
      pointer-events: none;
      position: fixed;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      z-index: 0;
      opacity: 1;
      overflow: hidden;
    }
    .star-bg-glow {
      filter: blur(2px) brightness(1.3);
      opacity: 0.7;
      z-index: 1;
    }
    .twinkle-bg {
      z-index: 2;
      pointer-events: none;
    }
    .shooting-star {
      position: absolute;
      width: 2.2px; height: 86px;
      background: linear-gradient(180deg, #fff7cb 15%, #aeeaff 60%, transparent 100%);
      opacity: 0.68;
      border-radius: 100px;
      pointer-events: none;
      animation: shooting-star 1.45s cubic-bezier(.8,.2,.2,1) forwards;
      box-shadow: 0 0 8px 3px #fffbe3cc, 0 0 25px #aeeaff77;
      image-rendering: pixelated;
    }
    @keyframes shooting-star {
      0%   { transform: translateY(-90px) scaleY(0.94) scaleX(0.8); opacity: 0; }
      8%  { opacity: 1; }
      85%  { opacity: 1; }
      100% { transform: translateY(110vh) scaleY(1.07) scaleX(0.92); opacity: 0; }
    }
    .twinkle-star {
      position: absolute;
      border-radius: 50%;
      background: #fffbe3;
      width: 2px; height: 2px;
      pointer-events: none;
      animation: twinkle 2.1s infinite alternate;
      image-rendering: pixelated;
    }
    @keyframes twinkle {
      0% { opacity: 0.48; box-shadow: 0 0 2px 1px #ffd; }
      50% { opacity: 1; box-shadow: 0 0 7px 2px #fffbe3, 0 0 13px #a3e9ff55; }
      100% { opacity: 0.26; box-shadow: 0 0 2px 1px #ffd; }
    }
    .nebula {
      position: fixed;
      pointer-events: none;
      z-index: 0;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: radial-gradient(ellipse at 35% 70%, #b5d3fb29 0%, #7fa8d144 33%, transparent 65%),
                  radial-gradient(ellipse at 75% 30%, #c9b3ff25 0%, #a3e9ff19 35%, transparent 80%);
      opacity: 0.58;
      mix-blend-mode: lighten;
      animation: nebula-float 14s linear infinite alternate;
      image-rendering: pixelated;
    }
    @keyframes nebula-float {
      0% { background-position: 0% 0%, 100% 100%; }
      100% { background-position: 10% 8%, 90% 92%; }
    }
    .aurora {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 3;
      background: radial-gradient(ellipse at 60% 0%, #8ef9ff22 0%, transparent 60%),
                  radial-gradient(ellipse at 15% 5%, #e5d3ff14 0%, transparent 55%),
                  radial-gradient(ellipse at 82% 20%, #ffeaff11 0%, transparent 65%);
      opacity: 0.18;
      mix-blend-mode: lighten;
      animation: aurora-move 16s linear infinite alternate;
      image-rendering: pixelated;
    }
    @keyframes aurora-move {
      0% { background-position: 0% 0%, 100% 100%, 50% 0%; }
      100% { background-position: 10% 8%, 90% 92%, 60% 10%; }
    }
    .lens-flare {
      position: fixed;
      pointer-events: none;
      left: 50%; top: 30%;
      width: 110px; height: 27px;
      z-index: 50;
      transform: translate(-50%, -50%) rotate(-12deg) scale(1);
      opacity: 0.13;
      background: radial-gradient(ellipse at 60% 50%, #fff5d9cc 0%, #fffbe3a0 40%, transparent 70%);
      filter: blur(4px);
      animation: flare-blink 8.6s infinite linear;
      image-rendering: pixelated;
    }
    @keyframes flare-blink {
      0% { opacity: 0.09; }
      18% { opacity: 0.19; }
      32% { opacity: 0.06; }
      35% { opacity: 0.16; }
      50% { opacity: 0.07; }
      100% { opacity: 0.13; }
    }
    .hidden { display: none !important; }
    .memory-title {
      font-size: 16px;
      color: #ffe764;
      text-shadow: 0 0 11px #fffbe3, 0 0 17px #ffe764b5, 0 0 32px #7eeaff50;
      letter-spacing: 0.5px;
      margin-bottom: 7px;
      margin-top: 26px;
      text-align: center;
      user-select: none;
      line-height: 1.25;
      font-family: 'Press Start 2P', monospace;
    }
    #memoryInstructionLines {
      width: 100%;
      max-width: 360px;
      margin: 0 auto 11px auto;
      display: block;
      text-align: center;
    }
    .memory-instruction-quote {
      color: #ffe764;
      font-size: 0.8em;
      background: rgba(38, 39, 80, 0.42);
      border-radius: 6px;
      padding: 8px 13px 8px 13px;
      border: 1.5px solid #ffe76455;
      display: inline-block;
      font-style: italic;
      letter-spacing: 0.5px;
      line-height: 1.8;
      white-space: pre-line;
      margin: 0 auto 0 auto;
      user-select: none;
      box-shadow: 0 0 10px #ffe7641c;
    }
    .pixel-frame {
      background: rgba(24,16,40,0.97);
      border-radius: 13px;
      box-shadow: 0 0 0 2px #ffe76477, 0 0 0 6px #353a5c, 0 0 50px 8px #aeeaff25, 0 0 0 1.5px #ffe764;
      max-width: 350px;
      width: 98vw;
      margin: 0 auto;
      margin-bottom: 21px;
      padding: 18px 11px 18px 11px;
      box-sizing: border-box;
      position: relative;
      display: block;
      text-align: center;
      z-index: 2;
      backdrop-filter: blur(0.7px);
      animation: float-in 1.2s cubic-bezier(.5,0,.2,1);
      transition: box-shadow 0.12s;
      image-rendering: pixelated;
    }
    /* WIDE PIXEL-FRAME FOR ARIA SCENE */
    #ariaFrame.pixel-frame {
      max-width: 820px;
      width: 100vw;
    }
    @keyframes float-in {
      0% { opacity: 0; transform: translateY(23px) scale(0.96);}
      100% { opacity: 1; transform: translateY(0) scale(1);}
    }
    @media (max-width: 500px) {
      .pixel-frame { max-width: 99vw; padding: 5vw 1vw 4vw 1vw; }
      .memory-title { font-size: 13px; }
      #memoryInstructionLines { max-width: 98vw; }
      #ariaFrame.pixel-frame { max-width: 99vw; }
    }
    .avatar {
      width: 58px;
      height: 58px;
      margin: 0 auto 16px auto;
      border-radius: 8px;
      box-shadow: 0 0 12px #ffe76433, 0 0 0 1.5px #ffe764, 0 0 12px #7eeaff25;
      border: 1px solid #ffe764;
      background: #191830;
      image-rendering: pixelated;
      transition: box-shadow 0.2s;
      animation: avatar-float 3.2s infinite cubic-bezier(.59,.03,.4,1.01) alternate;
    }
    @keyframes avatar-float {
      from { transform: translateY(0);}
      to   { transform: translateY(-8px);}
    }
    .pixel-text {
      color: #fffbe3;
      text-shadow: 1px 1px 0 #353a5c, 0 0 5px #ffe7646b;
      font-size: 12px;
      margin: 0.7em 0 0.4em 0;
      line-height: 1.8;
      letter-spacing: 0.7px;
      font-family: 'Press Start 2P', monospace;
      word-break: break-word;
      font-weight: normal;
      text-align: center;
    }
    .pixel-quote {
      color: #ffe764;
      font-size: 11px;
      margin-top: 1em;
      margin-bottom: 0.4em;
      text-shadow: 1px 1px 0 #353a5c, 0 0 7px #fffbe3b5;
      background: rgba(38, 39, 80, 0.31);
      border-radius: 4px;
      padding: 6px 8px;
      border: 1px solid #ffe76455;
      display: inline-block;
      font-style: italic;
      letter-spacing: 0.5px;
      line-height: 1.8;
      white-space: pre-line;
      text-align: center;
      box-shadow: 0 0 8px #ffe76410;
    }
   .button, .pixel-button {
      font-family: 'Press Start 2P', monospace;
      background: #191830;
      color: #ffe764;
      border: 2px solid #ffe764;
      border-radius: 6px;
      box-shadow: 0 2px 0 0 #353a5c, 0 0 8px #ffe76470 inset;
      padding: 4px 10px 4px 10px;
      cursor: pointer;
      margin: 13px 0 0 0;
      font-size: 10px;
      font-weight: normal;
      letter-spacing: 0.7px;
      text-shadow: 1px 1px 0 #353a5c, 0 0 4px #fffbe3b5;
      transition: background 0.16s, color 0.13s, border-color 0.13s, transform 0.07s;
      image-rendering: pixelated;
      position: relative;
      z-index: 1;
      outline: 0;
      min-width: 70px;
      min-height: 26px;;
      text-align: center;
      display: inline-block;
    }
    .button:hover, .pixel-button:hover {
      background: #ffe764;
      color: #191830;
      border-color: #fffbe3;
      transform: scale(1.07) translateY(-1px);
      box-shadow: 0 0 14px #ffe764ad, 0 3px 0 0 #353a5c;
    }
    .center-btn, .mewby-center-btn, .aria-btn-center {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      text-align: center;
    }
    .center-btn > *, .mewby-center-btn > *, .aria-btn-center > * {
      margin-left: 0 !important;
      margin-right: 0 !important;
      display: block;
      text-align: center;
    }
    .star-canvas {
      position: absolute;
      left: 0; top: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      image-rendering: pixelated;
    }
    .memory-fragment {
      width: 22px;
      height: 22px;
      margin: 5px;
      display: block;
      background: linear-gradient(145deg, #fffbe3 30%, #fcd34d 80%);
      border-radius: 50%;
      animation: glow 1.9s infinite alternate;
      cursor: pointer;
      box-shadow: 0 0 7px #fffbe3, 0 0 13px #ffe764;
      transition: box-shadow 0.15s, background 0.15s, border-color 0.15s, filter 0.12s;
      outline: 1px solid #fffbe3;
      outline-offset: 2px;
      border: 1px solid #ffe764;
      background-clip: padding-box;
      filter: drop-shadow(0 0 4px #ffe76430);
      image-rendering: pixelated;
    }
    .memory-fragment.visited {
      opacity: 0.22;
      pointer-events: none;
      background: #282840;
      border: 1px solid #ffe764;
      filter: none;
      box-shadow: 0 0 5px #ffe76422;
    }
    #memoryFragments {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      max-width: 120px;
      margin: 0 auto 4px auto;
      text-align: center;
      justify-content: center;
      z-index: 1;
      position: relative;
      image-rendering: pixelated;
    }
    #memoryMessageBox {
      display: none;
      font-size: 10px;
      color: #ffe764;
      background: rgba(38,39,80,0.21);
      border-radius: 7px;
      border: 1px solid #ffe76444;
      box-shadow: 0 0 8px #ffe76422;
      margin: 15px auto 0 auto;
      padding: 10px 10px 8px 10px;
      max-width: 210px;
      text-align: center;
      line-height: 1.8;
      font-weight: normal;
      letter-spacing: 0.13px;
      opacity: 1;
      transition: opacity 0.3s;
      position: relative;
      z-index: 2;
    }
    .aria-box {
      background: rgba(38, 39, 80, 0.56);
      border-radius: 7px;
      box-shadow: 0 0 7px #ffe76422;
      font-size: 13.2px;
      color: #ffeebc;
      text-shadow: 0 0 0px #ffe76444, 0px 0px 0 #353a5c;
      border: 1px solid #ffe76444;
      font-family: 'Press Start 2P', monospace;
      white-space: pre-line;
      line-height: 1.85;
      max-width: 820px;       /* Correct max width */
      width: 100%;            /* Full width within parent */
      margin: 0 auto;         /* Centered */
      padding: 32px 36px 30px 36px;
      word-break: break-word;
      box-sizing: border-box;
      text-align: left;
      animation: float-in 1.4s cubic-bezier(.5,0,.2,1);
    }
    #ariaSprite {
      width: 64px;
      height: 64px;
      margin: 0 auto 10px auto;
      border-radius: 7px;
      background: #191830;
      border: 1px solid #ffe764;
      box-shadow: 0 0 12px #ffe76455, 0 0 0 1px #ffe764;
      image-rendering: pixelated;
      text-align: center;
      animation: avatar-float 4.3s infinite alternate;
    }
    .final-choice-btns {
      gap: 14px;
      margin-top: 10px;
    }
    @keyframes glow {
      from { box-shadow: 0 0 8px #ffe764, 0 0 17px #fffbe3; }
      to { box-shadow: 0 0 11px #ffe764, 0 0 18px #fcd34d; }
    }
    @media (max-width: 500px) {
      .aria-box { font-size: 9.5px; max-width: 93vw; }
      #ariaSprite { width: 36px; height: 36px; }
      .pixel-frame { padding: 5vw 1vw 4vw 1vw;}
    }
    /* Meeting (journey) animation */
    #meetingScene {
      min-height: 110px;
      overflow: visible;
      background: transparent !important;
      box-shadow: none !important;
      image-rendering: pixelated;
    }
    #meetingBg {
      position: absolute;
      left: 0; top: 0; width: 100%; height: 100%;
      z-index: 0;
    }
    #herAvatar, #yourAvatar {
      transition: opacity 0.7s, left 1.6s cubic-bezier(.4,0,.5,1.2), box-shadow 0.6s, right 1.6s cubic-bezier(.4,0,.5,1.2);
      image-rendering: pixelated;
      bottom: 20px;
      position: absolute;
      z-index: 2;
      width: 62px; height: 62px;
      border-radius: 7px;
      background: #1c2340;
      box-shadow: 0 0 0 #fff;
    }
    #herAvatar {
      left: 3%;
      opacity: 0;
    }
    #yourAvatar {
      right: 3%;
      opacity: 0.77;
    }
    /* When they meet in the middle, overlap slightly */
    #herAvatar.meet {
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 0 18px #ffe4ff, 0 0 40px #c1e1ff;
      opacity: 1;
    }
    #yourAvatar.meet {
      right: 46%;
      transform: translateX(0%);
      box-shadow: 0 0 10px #aeeaff, 0 0 22px #ffe4ff;
      opacity: 1;
    }
  </style>
</head>
<body>
  <!-- Dreamy cosmic background layers -->
  <audio id="dreamyBgAudio" loop preload="auto">
    <source src="https://cdn.pixabay.com/audio/2023/03/22/audio_128b6f4415.mp3" type="audio/mp3">
  </audio>
  <button id="muteBtn" style="position:fixed;top:14px;right:14px;z-index:1000;
    background:rgba(38,39,80,0.6);border-radius:50%;border:2px solid #ffe764;
    width:26px;height:26px;display:flex;align-items:center;justify-content:center;
    color:#ffe764;font-size:13px;cursor:pointer;box-shadow:0 0 8px #ffe76450;">
    &#128266;
  </button>
  <div class="nebula"></div>
  <div class="star-bg" id="starBg"></div>
  <div class="star-bg-glow" id="starBgGlow"></div>
  <div class="twinkle-bg" id="twinkleBg"></div>
  <div class="aurora"></div>
  <div class="lens-flare"></div>

  <div class="memory-title" id="memoryTitle">Your memories with Aria</div>
  <div id="memoryInstructionLines">
    <span class="memory-instruction-quote" id="memoryInstructionQuote"></span>
  </div>

  <!-- MEWBIE INTRO SCENE -->
  <div class="pixel-frame" id="mainFrame">
    <img src="https://64.media.tumblr.com/647ca06c5a608d1ea1c416b21b839ea3/9a98a57c72a06121-2a/s250x400/7f925df3ce70975efc97a7f0ffac27ea3838ae3e.gif"
      alt="Mewby" class="avatar" />
    <p id="mewbyGreeting" class="pixel-text" style="min-height: 1.5em"></p>
    <div id="mewbyQuoteContainer" style="width:100%;">
      <p id="mewbyQuote" class="pixel-quote"></p>
    </div>
    <div class="center-btn mewby-center-btn">
      <button class="button" id="mewbyContinue" style="display:none;">Continue</button>
    </div>
  </div>

  <!-- MEMORIES SCENE -->
  <div class="pixel-frame hidden" id="memoriesFrame" style="position:relative;">
    <canvas id="starCanvas" class="star-canvas"></canvas>
    <div id="memoryFragments"></div>
    <div id="memoryMessageBox"></div>
    <div class="center-btn" id="memoriesNextBtnContainer" style="display:none;">
      <button class="button" id="memoriesNext" aria-label="Next to final scene">Next</button>
    </div>
  </div>

  <!-- FINAL CHOICE SCENE -->
  <div class="pixel-frame hidden" id="finalFrame">
    <p class="pixel-text" style="font-size:13px; margin-bottom:9px; color:#ffe764; text-shadow:0 0 9px #fffbe3;">
      You've remembered enough. What will you do?</p>
    <div class="final-choice-btns">
      <button class="button" id="chooseEasyBtn" onclick="chooseEasy()">Choose Easy</button>
      <button class="button" id="chooseHerBtn" onclick="chooseHer()">Choose Her</button>
    </div>
  </div>

  <!-- MEETING/JOURNEY SCENE -->
  <div class="pixel-frame hidden" id="meetingScene">
    <div id="meetingBg"></div>
    <img src="https://pixels.crd.co/assets/images/gallery115/4ff484db.gif?v=99d3974e" id="herAvatar"/>
    <img src="https://pixels.crd.co/assets/images/gallery115/7a912bf8.gif?v=99d3974e" id="yourAvatar"/>
    <audio id="meetingSfx" preload="auto">
      <source src="https://cdn.pixabay.com/audio/2022/07/26/audio_124b8b7e9e.mp3" type="audio/mp3">
    </audio>
  </div>

  <!-- ARIA MESSAGE SCENE -->
  <div class="pixel-frame centered hidden" id="ariaFrame">
    <img src="https://i.imgur.com/9OC7GRw.gif" alt="Aria" id="ariaSprite" />
    <div class="aria-box" id="ariaMsg"></div>
    <div class="aria-btn-center">
      <button class="pixel-button" id="ariaHomeBtn" onclick="window.location.href='https://frdffsdx.carrd.co/#home';" style="display:none;">
        return home
      </button>
    </div>
  </div>

  <script>
    // Dreamy audio logic
    const dreamyAudio = document.getElementById('dreamyBgAudio');
    const muteBtn = document.getElementById('muteBtn');
    let isMuted = false;
    let dreamyStarted = false;
    function startDreamyAudio() {
      if (!dreamyStarted) {
        dreamyAudio.volume = 0.22;
        dreamyAudio.currentTime = 0;
        dreamyAudio.play();
        dreamyStarted = true;
      }
    }
    window.addEventListener('pointerdown', startDreamyAudio, {once:true});
    muteBtn.onclick = () => {
      isMuted = !isMuted;
      dreamyAudio.muted = isMuted;
      muteBtn.innerHTML = isMuted ? "&#128263;" : "&#128266;";
    };

    // --- COSMIC STAR BACKGROUND ---
    function makeStars(container, count, colors, blur = false) {
      container.innerHTML = '';
      for(let i=0;i<count;i++){
        const s = document.createElement('div');
        let size = Math.random() < 0.85 ? 2 : (Math.random() < 0.8 ? 3 : 4);
        s.style.position = "absolute";
        s.style.left = `${Math.random()*100}%`;
        s.style.top = `${Math.random()*100}%`;
        s.style.width = s.style.height = `${size}px`;
        s.style.background = colors[Math.floor(Math.random()*colors.length)];
        s.style.opacity = (Math.random()*0.7+0.24).toFixed(2);
        s.style.borderRadius = "50%";
        s.style.boxShadow = blur
          ? `0 0 11px #a3e9fff7, 0 0 26px #fffbe3a8`
          : "0 0 6px #fff8ef, 0 0 13px #ffe764";
        s.style.filter = blur ? "blur(1.2px)" : "";
        s.style.pointerEvents = "none";
        s.style.imageRendering = "pixelated";
        container.appendChild(s);
      }
    }
    function spawnShootingStar() {
      const sky = document.getElementById('starBg');
      const star = document.createElement('div');
      star.className = 'shooting-star';
      star.style.left = `${Math.random()*96+2}vw`;
      star.style.top = `-${Math.random()*30+2}px`;
      sky.appendChild(star);
      setTimeout(() => star.remove(), 1500);
    }
    function makeTwinkles(container, count) {
      container.innerHTML = '';
      for(let i=0;i<count;i++) {
        const t = document.createElement('div');
        t.className = 'twinkle-star';
        t.style.left = `${Math.random()*100}%`;
        t.style.top = `${Math.random()*100}%`;
        let size = Math.random() < 0.8 ? 2 : 3;
        t.style.width = t.style.height = `${size}px`;
        t.style.animationDelay = `${Math.random()*2.1}s`;
        t.style.imageRendering = "pixelated";
        container.appendChild(t);
      }
    }
    function flareLoop() {
      const flare = document.querySelector('.lens-flare');
      flare.style.opacity = Math.random()*0.09 + 0.09;
      setTimeout(flareLoop, 6000+Math.random()*4000);
    }
    function refreshStars() {
      makeStars(document.getElementById('starBg'), 30, ["#fffbe3", "#ffe764", "#a3e9ff"], false);
      makeStars(document.getElementById('starBgGlow'), 12, ["#fffbe3", "#a3e9ff"], true);
      makeTwinkles(document.getElementById('twinkleBg'), 13);
    }
    window.addEventListener("DOMContentLoaded", () => {
      refreshStars();
      flareLoop();
    });
    window.addEventListener("resize", refreshStars);
    setInterval(() => { if(Math.random()<0.14) spawnShootingStar(); }, 1200);

    // --- INSTRUCTIONS TYPING ---
    const memoryInstructionLines = [
      "Click each memory fragment one at a time."
    ];
    let memoryInstructionLine = 0, memoryInstructionChar = 0;
    function typeMemoryInstructionLine() {
      const el = document.getElementById('memoryInstructionQuote');
      if (memoryInstructionLine < memoryInstructionLines.length) {
        if (memoryInstructionChar < memoryInstructionLines[memoryInstructionLine].length) {
          el.innerHTML += memoryInstructionLines[memoryInstructionLine][memoryInstructionChar++];
          setTimeout(typeMemoryInstructionLine, 60);
        } else {
          if (memoryInstructionLine < memoryInstructionLines.length - 1) {
            el.innerHTML += '<br>';
          }
          memoryInstructionLine++;
          memoryInstructionChar = 0;
          setTimeout(typeMemoryInstructionLine, 250);
        }
      }
    }

    // --- MEWBIE INTRO TYPING ---
    const mewbyGreetingText = "Hey! Mewby is here!";
    const mewbyQuoteLines = [
      "We’re about to take a little walk through memories and moments between you and Aria.",
      "Ready to start your journey?"
    ];
    let mewbyGreetingIndex = 0, mewbyQuoteLine = 0, mewbyQuoteChar = 0;
    function typeMewbyGreeting() {
      const el = document.getElementById('mewbyGreeting');
      if (mewbyGreetingIndex < mewbyGreetingText.length) {
        el.textContent += mewbyGreetingText[mewbyGreetingIndex++];
        setTimeout(typeMewbyGreeting, 60);
      } else {
        setTimeout(() => {
          document.getElementById('mewbyQuote').innerHTML = "";
          document.getElementById('mewbyQuoteContainer').style.display = 'block';
          typeMewbyQuoteLine();
        }, 440);
      }
    }
    function typeMewbyQuoteLine() {
      const quoteContainer = document.getElementById('mewbyQuoteContainer');
      quoteContainer.style.display = "block";
      const el = document.getElementById('mewbyQuote');
      if (mewbyQuoteLine < mewbyQuoteLines.length) {
        if (mewbyQuoteChar < mewbyQuoteLines[mewbyQuoteLine].length) {
          el.innerHTML += mewbyQuoteLines[mewbyQuoteLine][mewbyQuoteChar++];
          setTimeout(typeMewbyQuoteLine, 60);
        } else {
          if (mewbyQuoteLine < mewbyQuoteLines.length - 1) {
            el.innerHTML += '<br><br>';
          }
          mewbyQuoteLine++;
          mewbyQuoteChar = 0;
          setTimeout(typeMewbyQuoteLine, 400);
        }
      } else {
        setTimeout(() => {
          document.getElementById('mewbyContinue').style.display = 'inline-block';
        }, 400);
      }
    }
    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById('mewbyQuoteContainer').style.display = "block";
      typeMewbyGreeting();
      document.getElementById('memoryTitle').style.display = "none";
      document.getElementById('memoryInstructionLines').style.display = "none";
    });

    // --- SCENE MANAGEMENT ---
    function showOnly(id) {
      ['mainFrame','memoriesFrame','finalFrame','ariaFrame','meetingScene'].forEach(x => {
        document.getElementById(x).classList.add('hidden');
      });
      document.getElementById(id).classList.remove('hidden');
      // Hide the memory lane title/instructions unless we're in memoriesFrame
      const showMemoryStuff = (id === 'memoriesFrame');
      document.getElementById('memoryTitle').style.display = showMemoryStuff ? 'block' : 'none';
      document.getElementById('memoryInstructionLines').style.display = showMemoryStuff ? 'block' : 'none';
      if (showMemoryStuff) drawStars();
      window.scrollTo(0,0);
    }

    document.getElementById('mewbyContinue').onclick = () => {
      document.getElementById('memoryInstructionQuote').innerHTML = '';
      memoryInstructionLine = 0; memoryInstructionChar = 0;
      showOnly('memoriesFrame');
      setTimeout(typeMemoryInstructionLine, 420);
      initMemories();
    };

    // --- STAR CANVAS FOR MEMORY LANE ---
    function drawStars() {
      const canvas = document.getElementById('starCanvas');
      if (!canvas) return;
      const parent = document.getElementById('memoriesFrame');
      canvas.width = parent.offsetWidth;
      canvas.height = 110;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);

      for (let i = 0; i < 16; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height * 0.9 + 5;
        const size = Math.random() < 0.8 ? 2 : 4;
        ctx.save();
        ctx.globalAlpha = Math.random() * 0.4 + 0.5;
        ctx.fillStyle = Math.random() > 0.5 ? "#ffe764" : "#fffbe3";
        ctx.beginPath();
        ctx.arc(Math.floor(x), Math.floor(y), size, 0, 2 * Math.PI);
        ctx.fill();
        ctx.restore();
      }
    }
    window.addEventListener('resize', drawStars);

    // --- MEMORY LANE LOGIC ---
    const memoriesData = [
      { title: "First time we talked", desc: "That night when we stayed up late, just talking.", visited: false },
      { title: "Our favorite emoji", desc: " '><' and 'TT' represents US.", visited: false },
      { title: "Long distance calls", desc: "Our endless phone calls across the miles.", visited: false },
      { title: "Marathon nights", desc: "We just binged, sleep and feel together.", visited: false },
      { title: "Our first video game night", desc: "Laughing and playing like no distance existed.", visited: false },
      { title: "The first 'I love you'", desc: "That shy, unforgettable moment and our first day being official", visited: false }
    ];
    let memoryMessageTimeout = null;
    function initMemories() {
      drawStars();
      const memoryFragmentsEl = document.getElementById('memoryFragments');
      const messageBox = document.getElementById('memoryMessageBox');
      const memoriesNextBtn = document.getElementById('memoriesNext');
      const memoriesNextBtnContainer = document.getElementById('memoriesNextBtnContainer');
      memoryFragmentsEl.innerHTML = '';
      messageBox.style.display = "none";
      messageBox.textContent = "";
      memoriesNextBtnContainer.style.display = "none";
      memoriesNextBtn.disabled = true;
      memoriesNextBtn.style.opacity = 0.3;
      memoriesNextBtn.setAttribute('aria-disabled', 'true');
      if (memoryMessageTimeout) clearTimeout(memoryMessageTimeout);

      memoriesData.forEach((memory, i) => memory.visited = false);

      memoriesData.forEach((memory, i) => {
        const circle = document.createElement('div');
        circle.className = 'memory-fragment';
        circle.tabIndex = 0;
        circle.setAttribute('role', 'button');
        circle.setAttribute('aria-label', `${memory.title} memory`);
        circle.dataset.index = i;

        circle.addEventListener('click', () => {
          if (memory.visited) return;
          memory.visited = true;
          circle.classList.add('visited');
          // Show message
          messageBox.innerHTML =
            `<span style="font-size:11px;font-weight:bold;color:#ffe764;display:block;margin-bottom:6px;">${memory.title}</span>
            <span style="font-size:11px;color:#fffbe3;font-weight:normal;display:block;">${memory.desc}</span>`;
          messageBox.style.display = "block";
          messageBox.style.opacity = "1";
          if (memoryMessageTimeout) clearTimeout(memoryMessageTimeout);
          memoryMessageTimeout = setTimeout(() => {
            messageBox.style.opacity = "0";
            setTimeout(() => {
              messageBox.style.display = "none";
              messageBox.innerHTML = "";
            }, 500);
          }, 2200);

          // If all visited, enable Next button and show last desc
          if (memoriesData.every(m => m.visited)) {
            memoriesNextBtn.disabled = false;
            memoriesNextBtn.style.opacity = 1;
            memoriesNextBtn.setAttribute('aria-disabled', 'false');
            messageBox.innerHTML = `<span style="font-size:11px;font-weight:bold;color:#ffe764;display:block;margin-bottom:7px;">All memories revisited.</span>`;
            messageBox.style.display = "block";
            messageBox.style.opacity = "1";
            memoriesNextBtnContainer.style.display = "flex";
            if (memoryMessageTimeout) clearTimeout(memoryMessageTimeout);
          }
        });

        // Keyboard accessibility: Enter or Space triggers click
        circle.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            circle.click();
          }
        });

        memoryFragmentsEl.appendChild(circle);
      });

      memoriesNextBtn.onclick = () => {
        showOnly('finalFrame');
      };
    }

    // --- FINAL CHOICE LOGIC ---
    function chooseHer() {
      document.getElementById("chooseHerBtn").style.display = "none";
      document.getElementById("chooseEasyBtn").style.display = "none";
      // Animate meeting scene
      showOnly('meetingScene');
      let her = document.getElementById('herAvatar');
      let you = document.getElementById('yourAvatar');
      her.style.opacity = "1";
      her.classList.remove('meet');
      you.classList.remove('meet');
      her.style.left = "3%";
      her.style.transform = "";
      you.style.opacity = "0.77";
      you.style.right = "3%";
      you.style.transform = "";
      // Animate both moving to center to "meet"
      setTimeout(() => {
        her.classList.add('meet');
        you.classList.add('meet');
        document.getElementById('meetingSfx').play();
      }, 600);
      // After a while, show final letter
      setTimeout(() => {
        showAriaMessage();
        her.style.opacity = "0";
        you.style.opacity = "0";
      }, 2300);
    }
    function chooseEasy() {
      alert("You chose the easy way out... But this story is about choosing love.");
    }

    // --- ARIA MESSAGE SCENE ---
    const ariaMessage = `How was your journey, baby?
Did you have fun? I really hope so, TT.
This is the only way I could think of to make your day extra special—just me, my code, and, of course, you.
Since we both love games, I figured, why not design a world just for you? That’s how much you mean to me.

Our story started with a friendship that was tested by others, but somehow… you found your way back into my life.
When you did, I saw you in a new light, and everything changed.
That’s when we really began.
Honestly, even if I had to go through all the tough times again, I would, because I’d always choose you.

Being with you, even on the hardest days, means more to me than an easy life without you.
You’re my home now, loove. My forever.
Our road might be bumpy, but I’m grateful that, no matter what, every journey’s finish line is with you.

Just like this game, I want you to always remember that even when our journey isn’t perfect, when it feels like we’ve lost each other, or when we doubt ourselves if we're evee the righ person for each other— Baby, I’m always at the other end.
As long as we’re willing to keep trying, nothing is impossible for us.

I hope this little adventure reminded you of our story, there were sad times, but so many fun ones too.
It’s not perfect, but it’s everything to me, as long as you’re there.

Happy, happy birthday, my love. I’m so grateful I met you.
Thank you for coming back to me and choosing me.
I’ll always be thankful you were born, because you bring so much color to my life.

I can’t wait for us to meet again in person, imagine hugging and kissing you? that's the dream my looove!!
So you better get your ass here soon! Char!
I love you more than most, baby.
You really are the best-EST thing that ever happened to me.
Happy Happy Birthdaaaay love.`;

    function showAriaMessage() {
      showOnly('ariaFrame');
      const box = document.getElementById('ariaMsg');
      const homeBtn = document.getElementById('ariaHomeBtn');
      box.textContent = "";
      homeBtn.style.display = "none";
      let idx = 0;
      function typeAria() {
        if(idx <= ariaMessage.length){
          box.textContent = ariaMessage.substring(0, idx);
          idx++;
          setTimeout(typeAria, 60);
        } else {
          homeBtn.style.display = "inline-block";
        }
      }
      typeAria();
    }
  </script>
</body>
</html>
